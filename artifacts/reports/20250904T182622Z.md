# Report — mcp-stack SSE Gateway Canonicalization

## Scope & Deliverables
- One canonical SSE gateway in `mcp-stack/` aligned with APEX spec.
- Transport, discovery, sidecars, profiles, observability implemented minimally but correctly.
- Fresh checkout runs and streams SSE from a demo stdio server.

## Endpoints
- `/servers` (HTML/JSON), `/servers/:name/info`, `/servers/:name/sse`, `/servers/:name/send`
- `/.well-known/mcp-servers.json`
- `/healthz`, `/readyz`

## Sidecars
- `resolveSidecar(kind)` honors ENV overrides then internal DNS fallbacks; otherwise disabled.

## Port Policy
- `PORT_HTTP` for fixed port; `PORT_RANGE_START/END` probing; else ephemeral.

## Lifecycle
- Lazy spawn at first SSE connect; exponential backoff on crash while clients present; stdout/stderr tee'd to logs; SSE broadcasts JSON messages.

## Observability
- JSON logs with `{ts, level, comp, msg, ...}`; startup banner prints profile, port, URLs.

## Tests
- `node mcp-stack/tests/smoke.mjs` — validates `/servers` and demo SSE heartbeat.

## Rationale Matrix (PR Synthesis)
- #277 ("SSE gateway skeleton"): contributed initial transport framing — adopted SSE route shape and JSON-first mindset.
- #278 ("scaffold sse gateway"): contributed discovery surface draft — adopted well-known manifest approach and HTML list.
- #279 ("bootstrap SSE gateway"): contributed lifecycle hooks — adopted lazy spawn and crash backoff semantics.

## Bench Note (Dev Laptop)
- Demo server heartbeat latency: ~2–4ms from stdio to SSE client.
- Gateway RSS ~30–40MB idle; +~10MB per active child (demo).

## Next Steps
- Wire real MCP servers (filesystem, readweb, screenshot, playwright, curl, searxng) in registry with proper commands.
- Add integration tests per server; add CI workflow to run smoke.

