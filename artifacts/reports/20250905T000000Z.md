# Interlinker Fortification â€” Research Trace

Date: 2025-09-05 (UTC)

Root Cause
- Eleventy plugin `@photogabble/eleventy-plugin-interlinker@1.1.0` invoked RegExp `.match()` and `JSDOM(...)` on inputs that could be non-strings (numbers, objects, DOM-like), causing `TypeError: <value>.match is not a function` during markdown render and outbound link collection.

Patched Surfaces (ESM + CJS)
- `src/html-link-parser.js`: wrap document via `toHtmlString(...)` before `JSDOM`.
- `src/markdown-ext.js`: guard `state.src` type in both inline and block rules.
- `src/wikilink-parser.js`: `safeMatch(document, regex)` to coerce and match safely.
- `src/resolvers.js`: compile template content via `toHtmlString(template.content)`.
- `src/interlinker.js`: coerce `template.content` before concatenated parser passes.
- `index.cjs`: mirrored `toHtmlString`/`safeMatch` insertion and state guards.
- Added `src/util.js` with `toHtmlString` and `safeMatch`.

Docker/CI Patching Pattern
- Deps stage copies `patches/` before `npm ci` so `postinstall` applies patches.
- Builder stage runs `node tools/verify-patch-applied.mjs` before Eleventy.
- CI invokes the same verifier and fails fast if sentinel missing.

Discovery
- `tools/interlinker-hotfix-discover.mjs` writes plugin entrypoints, sentinel verification, Eleventy collections, and i18n defaults to `artifacts/reports/interlinker-hotfix-discovery.json`.

