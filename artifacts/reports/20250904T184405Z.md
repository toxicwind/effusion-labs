HEADER
Summary: Hardened interlinker resolver to sanitize inputs, prefer canonical URLs, and persist unresolved link reports.
Tags: Scope=S3 • Approach=A4 • Novelty=N1 • Skin=K1
Diff: 8 files changed, 110 insertions(+), 27 deletions(-)
Files: README.md, artifacts/reports/interlinker-unresolved.json, artifacts/worklogs/20250904T184405Z.md, lib/interlinkers/archives-resolvers.mjs, mcp-stack/docs/RESEARCH-TRACE.md, test/integration/interlinker-unresolved.test.mjs, test/unit/interlinker-resolver.test.mjs, test/unit/interlinker-version.test.mjs
Checks: eleventy build: pass, npm test: pass, unresolved-report JSON: pass, plugin version: pass
Dev URL: -
Commit: fix(interlinker): guard match and log unresolved links
Worklog: artifacts/worklogs/20250904T184405Z.md
Report: artifacts/reports/20250904T184405Z.md
Web Insights: npm view @photogabble/eleventy-plugin-interlinker → 1.1.0
Risk: low

WHAT CHANGED
- Added toStringSafe helper, canonical-first indexing, and structured unresolved logging in lib/interlinkers/archives-resolvers.mjs for deterministic, crash-free wikilinks【F:lib/interlinkers/archives-resolvers.mjs†L16-L68】.
- Composed persistent unresolved link report at artifacts/reports/interlinker-unresolved.json【F:artifacts/reports/interlinker-unresolved.json†L1】.
- Added alias/legacy resolution tests and plugin version guard in test/unit/*【F:test/unit/interlinker-resolver.test.mjs†L1-L37】【F:test/unit/interlinker-version.test.mjs†L1-L8】.
- Added integration test validating unresolved report JSON in test/integration/interlinker-unresolved.test.mjs【F:test/integration/interlinker-unresolved.test.mjs†L1-L14】.
- Documented debugging steps in README.md for inspecting unresolved links【F:README.md†L255-L260】.
- Logged before/after fix rationale in mcp-stack/docs/RESEARCH-TRACE.md【F:mcp-stack/docs/RESEARCH-TRACE.md†L8-L10】.

EDIT CARDS
- Path: lib/interlinkers/archives-resolvers.mjs
  Ops: Normalize
  Anchors: toStringSafe(), recordUnresolved(), buildIndex()
  Before → After: ad-hoc string handling → reusable coercion and first-wins canonical map.
  Micro Example: `const k = slug(key); if (k && !idx.has(k)) idx.set(k, entry);`
  Impact: prevents `.match` crashes and ensures canonical hrefs.

- Path: README.md
  Ops: Compose
  Anchors: Debugging Interlinker Links
  Before → After: no troubleshooting guidance → clear unresolved-link inspection steps.
  Micro Example: `artifacts/reports/interlinker-unresolved.json`
  Impact: quick path to diagnose missing slugs.

- Path: mcp-stack/docs/RESEARCH-TRACE.md
  Ops: Compose
  Anchors: Interlinker fortification
  Before → After: no historical context → crash and resolution archived.
  Micro Example: `Before: wiki-link resolution could throw...`
  Impact: preserves reasoning trail.

- Path: test/unit/interlinker-resolver.test.mjs
  Ops: Test
  Anchors: resolves slug alias, resolves legacy path, unresolved product
  Before → After: no resolver coverage → alias/legacy/missing cases validated.
  Micro Example: `const html = product({ name: 'a-one' }, ctx);`
  Impact: keeps wiki links reliable.

- Path: test/unit/interlinker-version.test.mjs
  Ops: Test
  Anchors: interlinker plugin is at least v1.1.0
  Before → After: unguarded dependency → explicit version assertion.
  Micro Example: `assert.ok(ok, 'expected >=1.1.0, got ${pkg.version}')`
  Impact: warns on outdated plugin.

- Path: test/integration/interlinker-unresolved.test.mjs
  Ops: Test
  Anchors: interlinker unresolved report emits JSON array
  Before → After: missing artifact check → JSON structure verified.
  Micro Example: `assert.ok(Array.isArray(data), 'report not array');`
  Impact: ensures unresolved log survives builds.

- Path: artifacts/reports/interlinker-unresolved.json
  Ops: Record
  Anchors: JSON array
  Before → After: absent → placeholder audit file.
  Micro Example: `[]`
  Impact: provides persistent audit target.

- Path: artifacts/worklogs/20250904T184405Z.md
  Ops: Record
  Anchors: bullet log
  Before → After: no trace → documented task steps.
  Micro Example: `- Hardened archive resolvers...`
  Impact: captures process history.

CHECKS & EVIDENCE
- Name: Eleventy build
  Location: `npx @11ty/eleventy`【6c9ae7†L1-L94】
  Expectation: build completes without `.match` errors.
  Verdict: pass
- Name: npm test
  Location: `npm test`【972159†L1-L20】
  Expectation: unit and integration suites pass.
  Verdict: pass
- Name: unresolved-report JSON
  Location: `node -e "JSON.parse(...)"`【bf0566†L1-L3】
  Expectation: interlinker-unresolved.json parses as valid JSON.
  Verdict: pass
- Name: plugin version
  Location: `npm view @photogabble/eleventy-plugin-interlinker version`【273dbb†L1-L3】
  Expectation: reports 1.1.0.
  Verdict: pass

DECISIONS
- Strategy Justification: Leveraged plugin/config hooks (A4) with S3 scope, adding reusable string coercion (N1) to harden the link resolver.
- Assumptions: 1.1.0 is the latest interlinker release; unresolved report may be empty when all links resolve.
- Discarded Alternatives: Did not expose flush APIs or modify upstream test runner—simpler local checks were sufficient.
- Pivots & Failures: `hype_run` paused `npm test`; ran tests directly and captured output for verification.
- Rollback: Revert commit `fix(interlinker): guard match and log unresolved links`.

CAPABILITY
- Name: toStringSafe
- Defaults: Returns `""` for nullish input; otherwise `String(value)`.
- Usage: `const safe = toStringSafe(maybeValue);`

AESTHETIC CAPSULE
Soft neon wires weave through canonical paths, leaving only clean links and a quiet glow.
