/**
 * @license Effusion Labs — Hypebrüt Overlay (Balanced Edition)
 *
 * A refactored version balancing aesthetics and performance. It restores some of
 * the original's visual flair while keeping the core optimizations that prevent lag.
 *
 * Key Features:
 * - A single, curated scene that composes on load. No expensive recomposition.
 * - Re-introduction of key visual elements like corner markers.
 * - Enhanced styling for a richer, more atmospheric look.
 * - A lightweight rendering loop that avoids animation lag.
 * - Layout analysis runs only once at boot to prevent performance issues.
 *
 * @version 3.1 (Balanced)
 * @author Effusion Labs (Refactored for Performance & Aesthetics)
 */(()=>{if(window.__mschfBooted)return;window.__mschfBooted=!0;const p=document.body||document.documentElement;if(!p||p.dataset.mschf==="off"||localStorage.getItem("mschf:off")==="1")return;const m=(e,t,o)=>Math.min(o,Math.max(t,e)),l=e=>e[Math.floor(Math.random()*e.length)],f=(e,t)=>{for(const o in t)e.style[o]=t[o];return e},r=(e,t,o)=>{const s=document.createElement(e);return t&&(s.className=t),(o||document.body).appendChild(s),s.style.pointerEvents="none",s.style.userSelect="none",n._mountCtx&&(s.dataset.mschf="1",s.dataset.mschfKind=n._mountCtx.kind||"unknown",s.dataset.mschfFamily=n._mountCtx.family||"unknown"),s},u=(()=>{const e=Math.max(1,window.innerWidth||1024),t=Math.max(1,window.innerHeight||768),o=e*t,d=(window.devicePixelRatio||1)>=1.5,i=e>=1440||o>=32e5,C=e>=2200||o>=5e6;return{width:e,height:t,degrade:C||d&&i}})(),x=[{name:"acid-lab",tokens:{ink:"#f6f8ff","ink-soft":"rgba(246, 248, 255, 0.68)",grid:"rgba(246, 248, 255, 0.12)","grid-alt":"rgba(12, 247, 254, 0.14)",pop:"#ff2e63","pop-alt":"#12fce6","pop-bold":"#f9ff33",wire:"rgba(255, 255, 255, 0.38)",glow:"rgba(255, 46, 99, 0.6)",halo:"rgba(12, 247, 254, 0.45)",paper:"rgba(10, 9, 23, 0.82)",noise:"0.06",shadow:"rgba(0, 0, 0, 0.42)",scan:"rgba(12, 247, 254, 0.45)","scan-tail":"rgba(255, 46, 99, 0.2)",plate:"rgba(12, 14, 25, 0.88)",tape:"#111318"}},{name:"proto-cyan",tokens:{ink:"#f5fffb","ink-soft":"rgba(245, 255, 251, 0.7)",grid:"rgba(245, 255, 251, 0.11)","grid-alt":"rgba(0, 255, 188, 0.18)",pop:"#00ffbc","pop-alt":"#ff6ad5","pop-bold":"#f9ff6a",wire:"rgba(150, 255, 230, 0.4)",glow:"rgba(0, 255, 188, 0.52)",halo:"rgba(255, 106, 213, 0.38)",paper:"rgba(5, 14, 12, 0.85)",noise:"0.045",shadow:"rgba(0, 0, 0, 0.4)",scan:"rgba(0, 255, 188, 0.45)","scan-tail":"rgba(255, 106, 213, 0.25)",plate:"rgba(8, 24, 24, 0.88)",tape:"#041814"}}],v=()=>{const e={...l(x)},t={...e.tokens||{}};return Math.random()<.35&&([t.pop,t["pop-alt"]]=[t["pop-alt"],t.pop]),{name:e.name,tokens:t,seed:Math.random().toString(16).slice(2,6)}},w=e=>{if(!(!e||!n.palette)){e.dataset.mschfPalette=n.palette.name||"";for(const[t,o]of Object.entries(n.palette.tokens||{}))e.style.setProperty(`--mschf-${t}`,o)}},n={root:null,domLayer:null,palette:v(),nodeBudget:u.degrade?50:80,nodeCount:0,actors:new Set,updaters:new Set,_updaterList:[],families:{scaffold:new Set,ephemera:new Set,frame:new Set},safeZones:[],actorBoxes:new Map,gridCols:10,gridRows:6,paused:!1,_mountCtx:null,readingPressure:0};function b(){let e=document.getElementById("mschf-overlay-root");e||(e=r("div","",document.body),e.id="mschf-overlay-root"),f(e,{pointerEvents:"none",userSelect:"none",position:"fixed",inset:"0",zIndex:"44",contain:"layout style paint",opacity:"0.9"}),e.setAttribute("aria-hidden","true"),e.innerHTML="",n.root=e,n.domLayer=r("div","mschf-layer",e),f(n.domLayer,{position:"absolute",inset:0,pointerEvents:"none",userSelect:"none"}),w(n.root)}function M(){const e=".prose, main, article, header, nav, [data-safe]",o=[];document.querySelectorAll(e).forEach(d=>{const i=d.getBoundingClientRect();i&&i.width>0&&i.height>0&&o.push({x:m(i.left-24,0,innerWidth),y:m(i.top-24,0,innerHeight),w:m(i.width+48,0,innerWidth),h:m(i.height+48,0,innerHeight)})}),n.safeZones=o;const s=document.querySelectorAll("p, li, blockquote").length;n.readingPressure=m(s/100,0,1)}const g=(e,t)=>Math.max(0,Math.min(e.x+e.w,t.x+t.w)-Math.max(e.x,t.x))*Math.max(0,Math.min(e.y+e.h,t.y+t.h)-Math.max(e.y,t.y)),k=e=>{const t=Math.max(1,e.w*e.h);for(const o of n.safeZones)if(g(e,o)/t>.05)return!0;for(const[,o]of n.actorBoxes)if(g(e,o)/t>.1)return!0;return!1};function S(e,t){for(let o=0;o<25;o++){const s=Math.random()*(innerWidth-e),d=Math.random()*(innerHeight-t),i={x:s,y:d,w:e,h:t};if(!k(i))return i}return{x:Math.random()*(innerWidth-e),y:Math.random()*(innerHeight-t),w:e,h:t}}function c(e,t){if(!e||n.nodeCount+(e.cost||1)>n.nodeBudget)return!1;n._mountCtx={kind:e.kind,family:t},n.families[t].add(e),n.actors.add(e),n.nodeCount+=e.cost||1;try{e.mount(n.domLayer)}catch{return n.families[t].delete(e),n.actors.delete(e),n.nodeCount=Math.max(0,n.nodeCount-(e.cost||1)),!1}typeof e.update=="function"&&n.updaters.add(e);const o=e.node?.getBoundingClientRect?.();return o?.width>0&&n.actorBoxes.set(e,{x:o.left,y:o.top,w:o.width,h:o.height}),n._mountCtx=null,!0}const a={};a.grid=()=>({kind:"grid",cost:1,mount(e){this.node=r("div","mschf-grid",e),this.node.dataset.variant=l(["dots","lines"])}}),a.rulers=()=>({kind:"rulers",cost:1,mount(e){const t=r("div","mschf-ruler mschf-ruler-top",e),o=r("div","mschf-ruler mschf-ruler-left",e);this.node={remove:()=>{t.remove(),o.remove()}}}}),a.corners=()=>({kind:"corners",cost:1,mount(e){const t=["tl","tr","bl","br"].map(o=>r("div",`mschf-corner mschf-corner-${o}`,e));this.node={remove:()=>t.forEach(o=>o.remove())}}}),a.plate=()=>({kind:"plate",cost:1,mount(e){this.node=r("div","mschf-plate",e),r("div","mschf-barcode",this.node);const t=r("div","mschf-code",this.node);t.textContent=`SEED:${Math.random().toString(16).slice(-6).toUpperCase()}`;const o=S(180,40);f(this.node,{left:`${o.x}px`,top:`${o.y}px`})}}),a.specimen=()=>({kind:"specimen",cost:1,mount(e){this.node=r("div","mschf-specimen",e);const t=Math.random().toString(36).slice(2,7).toUpperCase();this.node.innerHTML=`<strong>SPECIMEN</strong><span>ID ${t}</span><span>${new Date().toISOString().slice(0,10)}</span>`;const o=Math.random()<.5?"right":"left",s={top:`${16+Math.random()*20}px`};s[o]=`${18+Math.random()*24}px`,f(this.node,s)}}),a.brackets=()=>({kind:"brackets",cost:1,mount(e){this.node=r("div","mschf-brackets",e),this.node.dataset.variant=n.readingPressure>.3?"lite":"bold";const t=3+Math.random()*3;this.node.style.setProperty("--pad",`${t}vmin`),this.node.style.setProperty("--b",(this.node.dataset.variant==="lite"?2:3)+"px")}}),a.dims=()=>({kind:"dims",cost:1,mount(e){this.node=r("div","mschf-dims",e);const t=Math.random()<.5?8+Math.random()*12:78+Math.random()*12,o=6+Math.floor(Math.random()*24),s=24+Math.floor(Math.random()*32),d=Math.min(92,o+s);this.node.style.setProperty("--x1",`${o}vw`),this.node.style.setProperty("--x2",`${d}vw`),this.node.style.setProperty("--y",`${t}vh`);const i=r("em","mschf-dims-label",this.node);i.textContent=`${d-o}vw`,r("span","",this.node)}}),a.edgeGlow=()=>({kind:"edgeGlow",cost:1,mount(e){this.nodes=["top","right","bottom","left"].map(t=>r("div",`mschf-edge mschf-edge-${t}`,e)),this.node={remove:()=>this.nodes.forEach(t=>t.remove())}},update(e){const t=Math.max(.03,.07*(1-n.readingPressure*.8)),o=e/1e3*.2%1;for(const s of this.nodes)s.style.setProperty("--o",t.toFixed(3)),s.style.setProperty("--p",o.toFixed(3))}});function _(){c(a.grid(),"scaffold"),c(a.rulers(),"scaffold"),c(a.corners(),"scaffold"),c(a.edgeGlow(),"scaffold");const e=[a.brackets,a.dims];for(let s=0;s<2;s++)c(l(e)(),"frame");const t=[a.plate,a.specimen],o=u.degrade?1:2;for(let s=0;s<o;s++)Math.random()>n.readingPressure&&c(l(t)(),"ephemera")}function h(e){if(!n.paused){requestAnimationFrame(h);for(const t of n._updaterList)t.update(e)}}function y(){b(),M(),_(),n._updaterList=Array.from(n.updaters),requestAnimationFrame(h)}document.addEventListener("visibilitychange",()=>{n.paused=document.hidden,n.paused||requestAnimationFrame(h)},!1),document.readyState==="complete"||document.readyState==="interactive"?y():document.addEventListener("DOMContentLoaded",y),window.__mschfOff=()=>{localStorage.setItem("mschf:off","1"),n.root?.remove()},window.__mschfOn=()=>{localStorage.removeItem("mschf:off"),location.reload()}})();
//# sourceMappingURL=mschf-overlay.DENOLFo-.js.map
