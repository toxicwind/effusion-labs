#!/usr/bin/env bash
set -euo pipefail

. "$(cd "$(dirname "$0")" && pwd)/_lib.sh"

# Prefer npm package when present and functional
if "$REPO_ROOT/node_modules/.bin/fd" --version >/dev/null 2>&1; then
  exec "$REPO_ROOT/node_modules/.bin/fd" "$@"
fi

# Ubuntu often ships fd as 'fdfind'
retry_exec "$@" -- \
  "$TOOLS_DIR/fd/fd" \
  fdfind
apt_install fd-find >/dev/null 2>&1 || true
retry_exec "$@" -- \
  "$TOOLS_DIR/fd/fd" \
  fdfind

echo "❌ fd not available. On Ubuntu the binary may be 'fdfind'. Try: sudo apt-get install fd-find" >&2
exit 127
