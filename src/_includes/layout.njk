{# src/_includes/layout.njk #}
<!DOCTYPE html>
<html lang="en" data-theme="light" class="scroll-pt-16">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>{{ title }} | Effusion Labs</title>

  <meta name="color-scheme" content="dark light">
  <script>{% include '../scripts/theme-init.js' %}</script>

  <link rel="stylesheet" href="/assets/css/app.css">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700&family=Merriweather:wght@400;700&family=Roboto+Mono:wght@400;700&display=swap" rel="stylesheet">
  <script src="/assets/js/lucide.min.js"></script>
</head>

<body class="bg-background text-text font-body">
  <a href="#main" class="skip-link">Skip to main content</a>
  {% include 'header.njk' %}

  <div class="mx-auto max-w-screen-2xl px-6">
    {% set metaOff = metaDisable == true or metaDisable == 'true' %}
    {% set hasMeta = (status or certainty or importance or tags or memory_ref) and not metaOff %}

    <main id="main" class="
      {% if not metaOff %}xl:grid xl:gap-10 xl:grid-cols-[1fr_16rem]{% endif %}
      {% if showTitle != false %} mt-12{% endif %}
    ">
      <article class="prose dark:prose-invert max-w-none m-0
        {% if not metaOff %} xl:col-span-1 {% else %} w-full {% endif %}
      ">
        {% if showTitle != false %}
          <header class="mb-8">
            <h1 class="font-heading text-primary text-4xl tracking-wider">{{ title }}</h1>
          </header>
        {% endif %}
        {{ content | safe }}
      </article>

      {% if hasMeta %}
      <aside class="w-full mt-10 text-sm opacity-90 border-t border-border pt-4 xl:mt-0 xl:w-64 xl:pl-4 xl:border-t-0 xl:border-l">
        <div class="space-y-2 xl:sticky xl:top-28">
          <h2 class="font-heading text-lg font-semibold tracking-wide">Meta</h2>
          <ul class="space-y-1 text-text">
            {% if status %}<li><strong>Status:</strong> {{ status }}</li>{% endif %}
            {% if date %}
              <li><strong>Date:</strong>
                <time datetime="{{ date | htmlDateString }}">{{ date | readableDate }}</time>
              </li>
            {% endif %}
            {% if certainty %}<li><strong>Certainty:</strong> {{ certainty }}</li>{% endif %}
            {% if importance %}<li><strong>Importance:</strong> {{ importance }}</li>{% endif %}
            {% if tags %}
              <li><strong>Tags:</strong>
                <ul class="pl-4 list-disc">{% for tag in tags %}<li>{{ tag }}</li>{% endfor %}</ul>
              </li>
            {% endif %}
            {% if memory_ref %}
              <li><strong>Memory Ref:</strong>
                <ul class="pl-4 list-disc">{% for ref in memory_ref %}<li>{{ ref }}</li>{% endfor %}</ul>
              </li>
            {% endif %}
          </ul>
        </div>
      </aside>
      {% endif %}
    </main>

    <footer class="mt-16 p-8 text-center text-sm text-text/60 border-t border-border">
      <!-- DaisyUI Theme Controller -->
      <div class="flex items-center gap-2 p-2">
        <span>Theme</span>
        <input type="checkbox" class="toggle theme-controller" value="dark" />
      </div>
      <span class="block font-mono text-xs tracking-widest mb-2" data-build="{{ buildTime }}">{{ buildTime }}</span>
      &copy; 2025 Effusion Labs. A space for creative synthesis.
    </footer>
  </div>

  <script>lucide.createIcons();</script>
    <script src="/assets/js/footnote-nav.js" defer></script>
    <script src="/assets/js/code-copy.js" defer></script>
  </body>
</html>
